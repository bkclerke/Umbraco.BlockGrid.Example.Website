@using Microsoft.AspNetCore.Routing
@using Umbraco.Cms.Core
@using Umbraco.Cms.Core.Hosting
@using Umbraco.Extensions
@using Umbraco.Deploy.Core.Configuration.UI
@using Umbraco.Deploy.UI
@model Umbraco.Cms.Web.Website.Models.NoNodesViewModel

@inject LinkGenerator LinkGenerator
@inject DeployUiHubRoutes DeployUiHubRoutes
@inject IClientConfigurationInfoFactory ClientConfigurationInfoFactory
@inject IHostingEnvironment HostingEnvironment
<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Umbraco: No Published Content</title>

    <link rel="stylesheet" href="../../umbraco/assets/css/nonodes.style.min.css" />
    <link rel="stylesheet" href="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/assets/css/deploy.css" />
</head>
<body>

    @if (Context.Request.IsLocal() == false)
    {
        <section>
            <article>
                <div>
                    <div class="logo"></div>

                    <h1>Welcome to your Umbraco installation</h1>
                    <h3>You're seeing this wonderful page because your website doesn't contain any published content yet.</h3>

                    <div class="cta">
                        <a href="@Model.UmbracoPath" class="button">Open Umbraco</a>
                    </div>

                    <div class="row">
                        <div class="col">
                            <h2>Easy start with Umbraco.tv</h2>
                            <p>We have created a bunch of 'how-to' videos, to get you easily started with Umbraco. Learn how to build projects in just a couple of minutes. Easiest CMS in the world.</p>

                            <a href="https://umbraco.tv?ref=tvFromInstaller" target="_blank" rel="noopener">Umbraco.tv &rarr;</a>
                        </div>

                        <div class="col">
                            <h2>Be a part of the community</h2>
                            <p>The Umbraco community is the best of its kind, be sure to visit, and if you have any questions, we're sure that you can get your answers from the community.</p>

                            <a href="https://our.umbraco.com/?ref=ourFromInstaller" target="_blank" rel="noopener">our.Umbraco &rarr;</a>
                        </div>
                    </div>

                </div>
            </article>

        </section>
    }
    else
    {
        <section ng-controller="Umbraco.NoNodes.Controller as vm">
            <article class="ud-nonodes" ng-cloak>

                <div>
                    <div class="logo"></div>

                    <div>

                        <div ng-if="vm.restore.status === ''">

                            <h1>Initializing your website...</h1>

                            <div ng-if="vm.isDebug && vm.requiresInitialization">
                                <small>Press the button below to get started</small>
                                <div class="cta">
                                    <button class="button" ng-click="vm.restoreSchema()">Go!</button>
                                </div>
                            </div>
                        </div>

                        <div ng-if="vm.restore.status === 'ready'">
                            <h1>Restore from Umbraco Cloud</h1>
                            <div class="cta">
                                <button class="button" ng-click="vm.restoreData()">Restore</button>
                                <small><span>or</span> <a ng-href="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.Umbraco)">Skip restore and open Umbraco</a></small>
                            </div>
                        </div>

                        <div ng-if="vm.restore.status === 'inProgress'">
                            <h1>{{ vm.restore.restoreMessage }}</h1>
                            <p>{{ vm.restore.restoreProgress }}% restored</p>
                            <small>{{ vm.restore.currentActivity }}</small>
                            <div class="timestamp">{{ vm.restore.timestamp }}</div>
                        </div>

                        <div ng-if="vm.restore.status === 'completed'">
                            <h1>Ready to rock n' roll!</h1>
                            <p>Everything has been restored and is ready for use, click below to open Umbraco</p>
                            <div class="cta">
                                <a href="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.Umbraco)" class="button">Open Umbraco</a>
                            </div>
                        </div>

                        <ud-error ng-if="vm.restore.error.hasError"
                                  comment="vm.restore.error.comment"
                                  log="vm.restore.error.log"
                                  exception="vm.restore.error.exception"
                                  status="vm.restore.status"
                                  class="ud-restore-error"
                                  timestamp="vm.restore.timestamp"
                                  operation="restore"
                                  no-nodes="true"
                                  on-debug="vm.showDebug()"
                                  feedback-message-level="vm.feedbackMessageLevel">
                        </ud-error>

                        <div class="umb-deploy-debug" ng-if="vm.restore.showDebug">
                            <div class="umb-deploy-debug-console" ng-bind-html="vm.restore.trace|safe_html"></div>
                        </div>
                    </div>

                </div>
            </article>

        </section>

        @Html.Raw(NoNodesHelper.ServerVariables(LinkGenerator, DeployUiHubRoutes, ClientConfigurationInfoFactory))
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.Umbraco)/lib/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.Umbraco)/lib/angular/angular.min.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.Umbraco)/lib/signalr/signalr.min.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/js/nonodes.modules.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/js/deploy.resources.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/js/deploy.services.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/js/deploy.components.js"></script>
        <script type="text/javascript" src="@HostingEnvironment.ToAbsolute(Constants.SystemDirectories.AppPlugins)/Deploy/js/nonodes.bootstrap.js"></script>
        <script type="text/javascript">
            angular.bootstrap(document, ['umbraco.nonodes']);
        </script>
    }

</body>
</html>
